# TypeScript/React向けテストツールの比較と選定 (Testing Tools Research)

本ドキュメントでは、TypeScriptおよびReact (Vite) 環境で一般的に利用されるテストツールを比較・解説する。

## 1. 主要なテストランナー (Test Runners)

テストを実行するための基盤ツール。コードをスキャンし、テストケースを実行し、結果をレポートする役割を持つ。

| ツール名 | 特徴 | Vite環境との相性 | 評価 |
| :--- | :--- | :--- | :--- |
| **Vitest** | Viteネイティブのテストランナー。Viteの設定（`vite.config.ts`）を共有でき、セットアップが非常に簡単。実行速度が非常に高速。Jest互換のAPIを持つ。 | ◎ **最高** | **推奨**。<br>現在のプロジェクトがViteベースであるため、追加設定が最小限で済み、開発体験が良い。 |
| **Jest** | 長年のデファクトスタンダード。ドキュメントやプラグインが豊富。ただし、Vite環境で動かすにはBabel等の追加設定が必要で、構成が複雑になりがち。 | △ **普通** | 既存プロジェクトでの採用実績は多いが、Vite環境への新規導入では設定の手間がデメリットとなる。 |
| **Mocha** | 古くからある柔軟なツールだが、アサーションライブラリ（Chaiなど）を別途組み合わせる必要があり、モダンなReact開発では採用例が減っている。 | △ **普通** | あえて今選択する理由は薄い。 |

## 2. テストユーティリティ (Testing Utilities)

コンポーネントをレンダリングしたり、要素を取得したりするためのライブラリ。

| ツール名 | 特徴 | 評価 |
| :--- | :--- | :--- |
| **React Testing Library (RTL)** | **現在の業界標準**。「実装の詳細ではなく、ユーザーの振る舞いをテストする」という哲学に基づく。内部状態（State）を直接触るのではなく、画面上のテキストやボタンを通してテストする。 | **推奨**。<br>Create React AppやViteのテンプレートでも標準採用されている。 |
| **Enzyme** | かつての標準。コンポーネントの内部構造（StateやProps）を直接操作・検証できるが、React 18以降のサポートが終了しており、非推奨。 | × **非推奨** |

## 3. 推奨スタックの構成案

BodyAnalyst (Vite + React + TypeScript) において、最も一般的かつ合理的とされる構成は以下の通りである。

*   **実行基盤 (Runner):** `Vitest`
    *   理由: 高速、設定ファイル不要（Vite設定を流用）、Jest互換API。
*   **検証操作 (Utility):** `React Testing Library` + `@testing-library/user-event`
    *   理由: ユーザー視点でのテストが可能で、リファクタリングに強いテストが書ける。
*   **ブラウザ環境模倣:** `jsdom` または `happy-dom`
    *   理由: ブラウザなし（Node.js環境）でDOM操作をテストするために必要。`happy-dom` の方が高速だが、厳密性では `jsdom` が勝る。

## 4. テストの種類と導入の判断

テストツール導入にあたり、どのレイヤーをテストするかを決める必要がある。

| 種類 | 内容 | ツール | 導入コスト | データ保護への寄与 |
| :--- | :--- | :--- | :--- | :--- |
| **単体テスト (Unit)** | 関数やロジック単体の検証（計算ロジックなど）。 | Vitest | 低 | 中<br>(計算ミス防止) |
| **結合テスト (Integration)** | コンポーネントとDB等の連携検証。 | Vitest + RTL | 中 | **大**<br>(保存処理の確実性) |
| **E2Eテスト (End-to-End)** | 実際のブラウザでアプリ全体を動かす検証。 | Playwright / Cypress | 高 | 大<br>(実環境での動作保証) |

### 結論
まずは **Vitest + React Testing Library** を導入し、データ消失リスクの高い「保存処理（結合テスト）」と「複雑な計算ロジック（単体テスト）」をカバーするのが、コスト対効果として最適であると考えられる。
