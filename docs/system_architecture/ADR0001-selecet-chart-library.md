# ADR 0001: グラフ描画ライブラリと可視化エンジンアーキテクチャの選定

## ステータス
承認済み

## コンテキスト
本アプリケーション「BodyAnalyst」において、トレーニングデータの可視化はコア価値の一つである。
以下の要件を満たす可視化エンジンの設計とライブラリの選定が必要であった。

1.  **純粋関数性:** エンジンは副作用を持たず、入力（データ＋設定）に対して常に同じ出力（グラフ描画用Props）を返すこと。
2.  **再利用性:** グラフコンポーネントやデータ処理ロジックを容易に使い回せること。
3.  **美観:** ユーザー体験を向上させるため、美しくモダンなデザインであること。
4.  **開発効率:** 実装が複雑になりすぎず、理解しやすい構造であること。

## 検討された選択肢

### アーキテクチャパターン
1.  **パターンA: Functional Transformer (パイプライン型)**
    *   データと設定を一括で変換し、ライブラリ用Propsを生成する。
2.  **パターンB: Universal IR (中間表現型)**
    *   一度ライブラリ非依存の中間フォーマットに変換し、アダプターで描画する。
3.  **パターンC: Compositional Selectors (部品組立型)**
    *   View側で細かいSelector関数を組み合わせてPropsを作る。

### 描画ライブラリ
1.  **Recharts**
2.  **Nivo**
3.  **React-Chartjs-2**
4.  **Visx**

## 決定
アーキテクチャパターンとして **「パターンA: Functional Transformer」** を採用し、描画ライブラリとして **「Recharts」** を採用する。

## 決定の根拠

### アーキテクチャの決定理由
*   **パターンA (Functional Transformer)** は「入力→変換→出力」の流れが明確で、認知負荷が最も低い。
*   汎用的なインターフェース `(Data, Config) => Props` を定義することで、設定オブジェクトを切り替えるだけで多様なグラフを生成でき、高い再利用性を実現できる。
*   パターンBは実装コストが高く（オーバーエンジニアリング）、パターンCはViewが肥大化するため却下した。

### ライブラリの決定理由
*   **Recharts** はデータ構造がシンプル（オブジェクトの配列）であり、Functional Transformer が出力するデータをそのまま受け取りやすい。
*   **Nivo** はデザイン性に優れるが、グラフタイプごとにデータ構造やPropsが大きく異なるため、汎用的なTransformerの実装が困難である。
*   **Visx** は低レベルすぎてエンジンの責務が肥大化するため不採用。

### 「美観」への対応
Rechartsのデフォルトデザインはシンプルすぎるきらいがあるが、以下の戦略で解決する。
*   RechartsのデフォルトTooltipやLegendを使用しない。
*   代わりに **Shadcn/UI** と **Tailwind CSS** を用いた完全自作のコンポーネントをRechartsに注入する。
*   これにより、データ処理のシンプルさ（Rechartsの利点）と、アプリ全体の統一感ある美しさ（Shadcn/UIの利点）を両立させる。

## 影響
*   可視化エンジンは Recharts の Props 構造を出力するように設計される。
*   グラフの見た目をカスタマイズする際は、Rechartsの設定ではなく、カスタムコンポーネント（`src/features/analytics/engine/components/`）のCSSを修正することになる。
