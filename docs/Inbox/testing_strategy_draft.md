# テスト戦略 (Testing Specifications) - ドラフト

※ これは一時保存されたドラフトです。正式な採用前に技術調査が必要です。

## 1. 基本方針
アプリケーションの価値である「データの正確性」と「永続化の信頼性」を最優先事項とする。特に **Dexie.js (IndexedDB) へのデータ保存・取得ロジック** は重点的にテストを行い、ユーザーが記録したデータが意図せず失われることを防ぐ。

## 2. 採用ツール (Tool Stack)
Vite環境との親和性と高速な実行速度を重視し、以下のスタックを採用する。

*   **Test Runner:** `Vitest` (Viteネイティブで高速)
*   **Component Testing:** `React Testing Library` (ユーザー操作に近い形でのDOMテスト)
*   **User Interaction:** `@testing-library/user-event` (クリック、入力等のシミュレーション)
*   **Mocking:** `Vitest` built-in mocks (API呼び出し等はモック化)
*   **In-Memory DB:** `dexie` の機能または `indexeddb-export-import` を活用し、テスト実行時はメモリ上でDBを動作させ、本番環境を汚染せずに保存ロジックを検証する。

## 3. テストの階層と範囲

### 3.1. ロジック/単体テスト (Unit Tests) - **[高優先度]**
計算ロジックやデータ変換の正確性を保証する。
*   **対象:** `src/utils/` (カロリー計算、1RM計算、日付操作), `src/hooks/` (カスタムフックのロジック)
*   **検証内容:**
    *   境界値テスト (0, 負の値, 極端に大きな値)
    *   異常系入力時の挙動 (null, undefined, 不正なフォーマット)

### 3.2. データアクセス層テスト (Data Access Tests) - **[最重要]**
「保存したつもりで保存できていない」を防ぐ。
*   **対象:** `src/db/` (Dexie.js のスキーマ定義、CRUD操作)
*   **検証内容:**
    *   **Create:** データがDBに正しく格納されるか。必須フィールドが欠けている場合にエラーになるか。
    *   **Read:** クエリ（日付範囲指定など）が正しく機能し、期待通りのデータセットが返ってくるか。
    *   **Update/Delete:** 更新・削除が正しく反映されるか。誤って関係ないデータを消していないか。

### 3.3. 統合テスト (Integration Tests)
ユーザーの一連の操作フローが機能するか検証する。
*   **対象:** 主要な画面フロー (食事記録、ワークアウト記録)
*   **シナリオ例:** 「フォームに入力」→「保存ボタン押下」→「リストに追加されていること」を確認。

## 4. データ消失防止のための具体的施策

1.  **DBスキーマ変更時の回帰テスト:**
    *   将来的にDB構造を変更する場合、既存データが壊れないことを確認するテストケース（マイグレーションテスト）を必須とする。
2.  **バリデーションの徹底:**
    *   不正なデータ（未来の日付の体重、負のカロリー等）がDBに入り込まないよう、UI層とデータ層の両方でバリデーションをテストする。
